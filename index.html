<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1B5E20">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Ù…Ø¤Ø´Ø± - Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ø§Ù„Ù…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bog: { green: '#1B5E20', greenLight: '#2E7D32', greenDark: '#0D3D16', gold: '#C5A028', cream: '#F5F5F0' },
                        iam: { bg: '#0f1419', card: '#1c2128', border: '#30363d', green: '#238636', text: '#c9d1d9', textMuted: '#8b949e', input: '#0d1117' }
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'IBM Plex Sans Arabic', sans-serif; -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        html, body { overflow-x: hidden; }
        .gradient-header { background: linear-gradient(135deg, #0D3D16 0%, #1B5E20 50%, #2E7D32 100%); }
        .card { background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid #E5E5E5; }
        .btn-primary { background: linear-gradient(135deg, #1B5E20 0%, #2E7D32 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #0D3D16 0%, #1B5E20 100%); }
        .status-success { background: #E8F5E9; border: 1px solid #4CAF50; }
        .status-warning { background: #FFF8E1; border: 1px solid #FFC107; }
        .status-error { background: #FFEBEE; border: 1px solid #F44336; }
        .progress-bar { transition: width 0.8s ease; }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .ai-glow { box-shadow: 0 0 20px rgba(27, 94, 32, 0.3); }
        .stat-card { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); cursor: pointer; transition: all 0.3s; }
        .stat-card:hover { background: rgba(255,255,255,0.15); }
        .stat-card.active { background: rgba(255,255,255,0.2); border-color: #C5A028; }
        .expand-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; }
        .expand-content.open { max-height: 1200px; }
        .iam-input { background: #0d1117; border: 1px solid #30363d; color: #c9d1d9; }
        .iam-input:focus { border-color: #238636; outline: none; box-shadow: 0 0 0 3px rgba(35, 134, 54, 0.3); }
        .iam-btn-primary { background: #21262d; color: #8b949e; border: 1px solid #30363d; }
        .iam-btn-primary.active { background: #238636; color: white; border-color: #238636; }
        .iam-btn-green { background: #238636; color: white; }
        .iam-divider { display: flex; align-items: center; color: #8b949e; }
        .iam-divider::before, .iam-divider::after { content: ''; flex: 1; border-bottom: 1px solid #30363d; }
        .iam-divider::before { margin-left: 1rem; }
        .iam-divider::after { margin-right: 1rem; }
        .nafath-spinner { animation: spin 1.5s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .number-box { transition: all 0.3s; min-height: 70px; min-width: 70px; }
        .number-box.selected { background: #238636; color: white; border-color: #238636; }
        .stroke-green-500 { stroke: #22c55e; }
        .stroke-yellow-500 { stroke: #eab308; }
        .stroke-orange-500 { stroke: #f97316; }
        .stroke-red-500 { stroke: #ef4444; }
        .typing span { animation: blink 1.4s infinite; opacity: 0.3; }
        .typing span:nth-child(2) { animation-delay: 0.2s; }
        .typing span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0%, 60%, 100% { opacity: 0.3; } 30% { opacity: 1; } }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @media (max-width: 640px) {
            .chat-container { position: fixed; bottom: 0; left: 0; right: 0; width: 100%; border-radius: 16px 16px 0 0; max-height: 70vh; }
        }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-bog-cream min-h-screen">
    <div id="root"></div>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ===== ICONS =====
        const Icons = {
            Logo: ({ className = "w-8 h-8 sm:w-10 sm:h-10" }) => (
                <svg className={className} viewBox="0 0 100 100" fill="none">
                    <circle cx="50" cy="50" r="45" fill="#1B5E20"/>
                    <path d="M30 70V35h8v35h-8zM42 70V45h8v25h-8zM54 70V40h8v30h-8zM66 70V30h8v40h-8z" fill="#C5A028"/>
                    <circle cx="50" cy="25" r="8" fill="#C5A028"/>
                </svg>
            ),
            Check: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
            Warning: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
            Error: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            Document: () => <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
            Upload: () => <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>,
            AI: () => <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>,
            Scan: () => <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" /></svg>,
            Chat: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>,
            Shield: () => <svg className="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
            Link: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>,
            ArrowLeft: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>,
            ArrowRight: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>,
            Calendar: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
            ChevronDown: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
            ChevronUp: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 15l7-7 7 7" /></svg>,
            User: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
            Users: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
            Trophy: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" /></svg>,
            Target: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
            Route: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" /></svg>,
            Fingerprint: () => <svg className="w-8 h-8 sm:w-10 sm:h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4" /></svg>,
            Smartphone: () => <svg className="w-6 h-6 sm:w-8 sm:h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>,
            Logout: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
            Close: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
            Clock: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
            ExternalLink: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>,
            BarChart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
        };

        // ===== DATA =====
        const statsData = {
            tracks: { title: 'Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª', items: [{ name: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙˆÙ„', desc: 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©', icon: 'ğŸ§ ' }, { name: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ', desc: 'Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„ØªÙ…ÙƒÙŠÙ† Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯', icon: 'ğŸ‘¥' }] },
            challenges: { title: 'Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª', items: [{ name: 'Ø§Ù„Ø­Ø¯ Ù…Ù† Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¦ÙŠØ©', track: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙˆÙ„', icon: 'âš–ï¸' }, { name: 'ØªØ³Ø±ÙŠØ¹ ÙØ±Ø² ÙˆØªØµÙ†ÙŠÙ Ø§Ù„Ø¯Ø¹Ø§ÙˆÙ‰', track: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙˆÙ„', icon: 'ğŸ“Š' }, { name: 'Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª', track: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ', icon: 'ğŸ“‹', selected: true }, { name: 'Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„', track: 'Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ', icon: 'â™¿' }] },
            criteria: { title: 'Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„ØªØ­ÙƒÙŠÙ…', items: [{ name: 'Ù‚Ø§Ø¨Ù„ÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°', weight: '10%' }, { name: 'Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†ÙÙŠØ°', weight: '10%' }, { name: 'Ø§Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ', weight: '10%' }, { name: 'Ø§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©', weight: '10%' }, { name: 'Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙ‚Ù†ÙŠ', weight: '10%' }, { name: 'Ø£ØµØ§Ù„Ø© Ø§Ù„ÙÙƒØ±Ø©', weight: '10%' }, { name: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙ„Ø©', weight: '10%' }, { name: 'Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹', weight: '10%' }, { name: 'Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹', weight: '10%' }, { name: 'Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¹Ø±Ø¶', weight: '10%' }] },
            team: { title: 'Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚', items: [{ name: 'Ø§Ù„Ù…Ø­Ø§Ù…ÙŠØ©/ Ù†ÙˆÙ Ø§Ù„Ø¹Ø¬Ù…ÙŠ', role: 'Ù‚Ø§Ø¦Ø¯ Ø§Ù„ÙØ±ÙŠÙ‚', icon: 'ğŸ‘©â€âš–ï¸' }, { name: 'Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³/ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹ØµÙ„Ø§Ù†ÙŠ', role: 'Ø§Ù„Ù…Ø·ÙˆØ± Ø§Ù„ØªÙ‚Ù†ÙŠ', icon: 'ğŸ‘¨â€ğŸ’»' }, { name: 'Ø§Ù„Ø£Ø³ØªØ§Ø°Ø©/ Ø­ØµØ© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ', role: 'Ø¹Ø¶Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚', icon: 'ğŸ‘©â€ğŸ’¼' }, { name: 'Ø§Ù„Ø£Ø³ØªØ§Ø°Ø©/ Ø±ÙˆØ§Ù† Ø¢Ù„ Ø³ÙŠÙ', role: 'Ø¹Ø¶Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚', icon: 'ğŸ‘©â€ğŸ’¼' }, { name: 'Ø§Ù„Ø£Ø³ØªØ§Ø°Ø©/ Ù…Ø±ÙŠÙ… Ø§Ù„Ø£Ø­Ù…Ø±ÙŠ', role: 'Ø¹Ø¶Ùˆ Ø§Ù„ÙØ±ÙŠÙ‚', icon: 'ğŸ‘©â€ğŸ’¼' }] }
        };

        const rejectionStats = [
            { reason: 'ÙÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©', percentage: 35, color: 'bg-red-500' },
            { reason: 'Ù†Ù‚Øµ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', percentage: 25, color: 'bg-orange-500' },
            { reason: 'Ø¹Ø¯Ù… Ø§Ù„ØªØ¸Ù„Ù… Ø§Ù„Ù…Ø³Ø¨Ù‚', percentage: 20, color: 'bg-yellow-500' },
            { reason: 'ÙˆÙƒØ§Ù„Ø© Ù…Ù†ØªÙ‡ÙŠØ© Ø£Ùˆ Ù†Ø§Ù‚ØµØ©', percentage: 12, color: 'bg-blue-500' },
            { reason: 'Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', percentage: 8, color: 'bg-purple-500' },
        ];

        const aiAnalysisResults = {
            'Ù‡ÙˆÙŠØ©': { status: 'success', message: 'Ø§Ù„Ù‡ÙˆÙŠØ© Ø³Ø§Ø±ÙŠØ©', details: ['ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©', 'Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø©'], confidence: 98 },
            'Ù‚Ø±Ø§Ø±': { status: 'success', message: 'Ø§Ù„Ù‚Ø±Ø§Ø± Ù…ÙƒØªÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', details: ['Ø±Ù‚Ù… Ø§Ù„Ù‚Ø±Ø§Ø±: 1234/46', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 1446/03/15 Ù‡Ù€'], confidence: 95 },
            'ØªØ¸Ù„Ù…': { status: 'warning', message: 'Ø§Ù„ØªØ¸Ù„Ù… Ù…Ù‚Ø¨ÙˆÙ„', details: ['ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¸Ù„Ù…: 1446/04/01 Ù‡Ù€'], confidence: 85 },
            'Ø±Ø¯': { status: 'success', message: 'Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ù…ÙˆØ«Ù‚', details: ['ØªØ§Ø±ÙŠØ® Ø§Ù„Ø±Ø¯: 1446/05/01 Ù‡Ù€'], confidence: 92 },
            'ÙˆÙƒØ§Ù„Ø©': { status: 'success', message: 'Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø³Ø§Ø±ÙŠØ©', details: ['ØµØ§Ø¯Ø±Ø© Ù…Ù† Ù†Ø§Ø¬Ø²', 'ØªØ´Ù…Ù„ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙ‚Ø§Ø¶ÙŠ'], confidence: 96 },
            'Ø±Ø®ØµØ©': { status: 'success', message: 'Ø§Ù„Ø±Ø®ØµØ© Ø³Ø§Ø±ÙŠØ©', details: ['Ø±Ø®ØµØ© Ù…Ø­Ø§Ù…Ø§Ø© Ù…Ø¹ØªÙ…Ø¯Ø©'], confidence: 97 },
        };

        // ===== NAFATH LOGIN =====
        const NafathLogin = ({ onLoginSuccess }) => {
            const [stage, setStage] = useState('input');
            const [nationalId, setNationalId] = useState('');
            const [error, setError] = useState('');
            const [verificationNumber, setVerificationNumber] = useState(null);
            const [selectedNumber, setSelectedNumber] = useState(null);
            const [countdown, setCountdown] = useState(90);
            const VALID_ID = '1234567890';

            const handleSubmit = () => {
                if (nationalId.length !== 10) { setError('Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 10 Ø£Ø±Ù‚Ø§Ù…'); return; }
                setError(''); setStage('verifying');
                setTimeout(() => {
                    if (nationalId === VALID_ID) { setVerificationNumber(Math.floor(Math.random() * 90) + 10); setStage('numbers'); }
                    else { setStage('error'); }
                }, 2000);
            };

            const handleNumberSelect = (num) => {
                setSelectedNumber(num);
                if (num === verificationNumber) {
                    setStage('success');
                    setTimeout(() => onLoginSuccess({ id: nationalId, name: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯', verified: true }), 1500);
                }
            };

            useEffect(() => {
                if (stage === 'numbers' && countdown > 0) {
                    const timer = setTimeout(() => setCountdown(countdown - 1), 1000);
                    return () => clearTimeout(timer);
                }
            }, [stage, countdown]);

            const generateNumbers = () => {
                if (!verificationNumber) return [];
                const numbers = [verificationNumber];
                while (numbers.length < 3) { const rand = Math.floor(Math.random() * 90) + 10; if (!numbers.includes(rand)) numbers.push(rand); }
                return numbers.sort(() => Math.random() - 0.5);
            };

            return (
                <div className="min-h-screen bg-iam-bg flex items-center justify-center p-4">
                    <div className="w-full max-w-md">
                        <div className="bg-iam-card rounded-xl p-6 sm:p-8 shadow-2xl border border-iam-border">
                            {stage === 'input' && (
                                <div className="fade-in">
                                    <div className="text-center mb-6">
                                        <h1 className="text-2xl sm:text-3xl font-bold text-white mb-2">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
                                        <p className="text-iam-textMuted text-sm">Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ Ø®Ø¯Ù…Ø© Ù…Ø¤Ø´Ø±</p>
                                    </div>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-iam-text mb-2">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© <span className="text-red-500">*</span></label>
                                        <input type="tel" inputMode="numeric" value={nationalId} onChange={(e) => setNationalId(e.target.value.replace(/\D/g, '').slice(0, 10))} placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©" className="w-full p-3 rounded-lg iam-input text-lg" dir="rtl" />
                                        {error && <p className="text-red-500 text-sm mt-2">{error}</p>}
                                    </div>
                                    <button onClick={handleSubmit} disabled={nationalId.length !== 10} className={`w-full p-3 rounded-lg font-bold text-lg mb-4 ${nationalId.length === 10 ? 'iam-btn-primary active' : 'iam-btn-primary'}`}>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                                    <div className="iam-divider text-sm mb-4">Ø£Ùˆ</div>
                                    <button className="w-full p-3 rounded-lg iam-btn-green font-bold">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                                    <div className="mt-6 p-3 bg-iam-input rounded-lg border border-iam-border">
                                        <p className="text-xs text-iam-textMuted text-center">ğŸ’¡ Ù„Ù„ØªØ¬Ø±Ø¨Ø©: <code className="bg-iam-card px-2 py-1 rounded text-iam-text">1234567890</code></p>
                                    </div>
                                </div>
                            )}
                            {stage === 'verifying' && (
                                <div className="text-center py-8 fade-in">
                                    <div className="relative w-16 h-16 mx-auto mb-4">
                                        <div className="absolute inset-0 border-4 border-iam-green rounded-full nafath-spinner" style={{ borderTopColor: 'transparent' }}></div>
                                        <div className="absolute inset-2 bg-iam-input rounded-full flex items-center justify-center"><Icons.Smartphone /></div>
                                    </div>
                                    <h3 className="text-lg font-bold text-white mb-2">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚</h3>
                                    <p className="text-iam-textMuted text-sm">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
                                </div>
                            )}
                            {stage === 'numbers' && (
                                <div className="text-center fade-in">
                                    <div className="mb-4">
                                        <div className="w-12 h-12 bg-iam-input rounded-full flex items-center justify-center mx-auto mb-3 border border-iam-border"><Icons.Smartphone /></div>
                                        <h3 className="text-lg font-bold text-white mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</h3>
                                        <p className="text-iam-textMuted text-sm mb-3">Ø§Ø®ØªØ± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØµØ­ÙŠØ­</p>
                                        <div className="bg-iam-green/20 border border-iam-green rounded-lg p-2 mb-4">
                                            <p className="text-sm text-iam-green">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØµØ­ÙŠØ­: <strong className="text-xl">{verificationNumber}</strong></p>
                                        </div>
                                    </div>
                                    <div className="flex justify-center gap-3 mb-4">
                                        {generateNumbers().map((num) => (
                                            <button key={num} onClick={() => handleNumberSelect(num)} className={`w-16 h-16 rounded-xl border-2 border-iam-border text-xl font-bold number-box text-iam-text ${selectedNumber === num ? 'selected' : ''}`}>{num}</button>
                                        ))}
                                    </div>
                                    <div className="text-xs text-iam-textMuted">ÙŠÙ†ØªÙ‡ÙŠ Ø®Ù„Ø§Ù„: <span className="font-bold text-iam-green">{countdown}</span> Ø«Ø§Ù†ÙŠØ©</div>
                                </div>
                            )}
                            {stage === 'success' && (
                                <div className="text-center py-8 fade-in">
                                    <div className="w-16 h-16 bg-iam-green/20 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <svg className="w-8 h-8 text-iam-green" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" /></svg>
                                    </div>
                                    <h3 className="text-lg font-bold text-iam-green mb-2">ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                                    <p className="text-iam-textMuted text-sm">Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„Ùƒ...</p>
                                </div>
                            )}
                            {stage === 'error' && (
                                <div className="text-center py-8 fade-in">
                                    <div className="w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-3">
                                        <svg className="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M6 18L18 6M6 6l12 12" /></svg>
                                    </div>
                                    <h3 className="text-lg font-bold text-red-500 mb-2">ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚</h3>
                                    <p className="text-iam-textMuted mb-4 text-sm">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­</p>
                                    <button onClick={() => { setStage('input'); setNationalId(''); }} className="px-4 py-2 iam-btn-green rounded-lg font-bold text-sm">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // ===== HEADER =====
        const Header = ({ user, onLogout }) => (
            <header className="gradient-header text-white">
                <div className="max-w-6xl mx-auto px-3 sm:px-4 py-3">
                    <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2 sm:gap-4">
                            <Icons.Logo />
                            <div>
                                <h1 className="text-base sm:text-xl font-bold">Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ø§Ù„Ù…</h1>
                                <p className="text-green-200 text-xs hidden sm:block">Board of Grievances</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2 sm:gap-4">
                            <div className="hidden md:block bg-white/10 px-3 py-2 rounded-lg text-xs">
                                <span className="text-green-200">Ù‡Ø§ÙƒØ§Ø«ÙˆÙ† Ø°ÙƒØ§Ø¡ Ø§Ù„Ù‚Ø¶Ø§Ø¡</span>
                                <span className="mx-2">|</span>
                                <span>4-5 ÙØ¨Ø±Ø§ÙŠØ± 2026</span>
                            </div>
                            {user && (
                                <div className="flex items-center gap-2 bg-white/10 px-2 sm:px-3 py-2 rounded-lg">
                                    <div className="w-7 h-7 bg-bog-gold rounded-full flex items-center justify-center"><Icons.User /></div>
                                    <div className="hidden sm:block text-sm">
                                        <div className="font-medium">{user.name}</div>
                                        <div className="text-green-200 text-xs flex items-center gap-1"><span className="w-2 h-2 bg-green-400 rounded-full"></span>Ù…ÙˆØ«Ù‚</div>
                                    </div>
                                    <button onClick={onLogout} className="p-2 hover:bg-white/10 rounded-lg"><Icons.Logout /></button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            </header>
        );

        // ===== REJECTION STATS BANNER =====
        const RejectionStatsBanner = () => {
            const [isOpen, setIsOpen] = useState(false);
            return (
                <div className="bg-gradient-to-l from-red-900 to-red-800 text-white">
                    <div className="max-w-4xl mx-auto px-4 py-3">
                        <button onClick={() => setIsOpen(!isOpen)} className="w-full flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <Icons.BarChart />
                                <span className="font-bold text-sm sm:text-base">Ù„Ù…Ø§Ø°Ø§ ØªÙØ±ÙØ¶ Ø§Ù„Ø¯Ø¹Ø§ÙˆÙ‰ Ø´ÙƒÙ„ÙŠØ§Ù‹ØŸ</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="text-xs bg-white/20 px-2 py-1 rounded">Ù…Ø¤Ø´Ø± ÙŠØ¹Ø§Ù„Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨</span>
                                {isOpen ? <Icons.ChevronUp /> : <Icons.ChevronDown />}
                            </div>
                        </button>
                        <div className={`expand-content ${isOpen ? 'open' : ''}`}>
                            <div className="pt-4 space-y-2">
                                {rejectionStats.map((stat, i) => (
                                    <div key={i} className="flex items-center gap-3">
                                        <div className="w-12 text-left font-bold">{stat.percentage}%</div>
                                        <div className="flex-1 h-6 bg-white/20 rounded-full overflow-hidden">
                                            <div className={`h-full ${stat.color} rounded-full transition-all duration-1000`} style={{ width: isOpen ? `${stat.percentage}%` : '0%' }}></div>
                                        </div>
                                        <div className="w-40 text-xs text-right">{stat.reason}</div>
                                    </div>
                                ))}
                                <p className="text-center text-xs text-white/70 pt-2 border-t border-white/20 mt-3">* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªÙ‚Ø¯ÙŠØ±ÙŠØ© Ù„Ù„ØªÙˆØ¶ÙŠØ­</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ===== STATS SECTION =====
        const StatsSection = () => {
            const [expanded, setExpanded] = useState(null);
            const stats = [
                { id: 'tracks', value: '2', label: 'Ù…Ø³Ø§Ø±Ø§Øª', icon: <Icons.Route /> },
                { id: 'challenges', value: '4', label: 'ØªØ­Ø¯ÙŠØ§Øª', icon: <Icons.Target /> },
                { id: 'criteria', value: '10', label: 'Ù…Ø¹Ø§ÙŠÙŠØ±', icon: <Icons.Trophy /> },
                { id: 'team', value: '5', label: 'Ø§Ù„ÙØ±ÙŠÙ‚', icon: <Icons.Users /> },
            ];

            return (
                <div className="gradient-header py-4 sm:py-6">
                    <div className="max-w-4xl mx-auto px-3 sm:px-4">
                        <div className="grid grid-cols-4 gap-2 sm:gap-4">
                            {stats.map((stat) => (
                                <button key={stat.id} onClick={() => setExpanded(expanded === stat.id ? null : stat.id)} className={`stat-card p-3 sm:p-4 rounded-xl text-center ${expanded === stat.id ? 'active' : ''}`}>
                                    <div className="text-2xl sm:text-3xl font-bold text-white">{stat.value}</div>
                                    <div className="text-white/80 text-xs sm:text-sm">{stat.label}</div>
                                </button>
                            ))}
                        </div>
                        {expanded && statsData[expanded] && (
                            <div className="bg-white/5 rounded-xl p-3 mt-4 border border-white/10 fade-in">
                                <h4 className="text-base font-bold text-white mb-3">{statsData[expanded].title}</h4>
                                <div className="space-y-2 max-h-48 overflow-y-auto hide-scrollbar">
                                    {statsData[expanded].items.map((item, i) => (
                                        <div key={i} className={`p-2 rounded-lg border ${item.selected ? 'bg-bog-gold/20 border-bog-gold' : 'bg-white/5 border-white/10'}`}>
                                            <div className="flex items-center gap-2">
                                                {item.icon && <span className="text-lg">{item.icon}</span>}
                                                <div className="flex-1 min-w-0">
                                                    <div className="font-medium text-white text-sm flex items-center gap-2">
                                                        <span className="truncate">{item.name}</span>
                                                        {item.selected && <span className="text-xs bg-bog-gold text-black px-2 py-0.5 rounded-full">Ø§Ù„Ù…Ø®ØªØ§Ø±</span>}
                                                    </div>
                                                    {item.desc && <div className="text-xs text-white/60 truncate">{item.desc}</div>}
                                                    {item.role && <div className="text-xs text-bog-gold">{item.role}</div>}
                                                    {item.weight && <div className="text-xs text-bog-gold">{item.weight}</div>}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // ===== DEADLINE CALCULATOR =====
        const DeadlineCalculator = ({ dates, setDates }) => {
            const calculateDeadline = () => {
                if (!dates.grievanceDate) return null;
                const grievance = new Date(dates.grievanceDate);
                const today = new Date();
                const daysSinceGrievance = Math.floor((today - grievance) / (1000 * 60 * 60 * 24));
                
                let deadlineDate, daysRemaining, canFile = false, message = '';
                
                if (dates.responseDate) {
                    // Response received - 60 days from response
                    const response = new Date(dates.responseDate);
                    deadlineDate = new Date(response);
                    deadlineDate.setDate(deadlineDate.getDate() + 60);
                    daysRemaining = Math.floor((deadlineDate - today) / (1000 * 60 * 60 * 24));
                    canFile = true;
                    message = 'ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø§Ù„Ø¯Ø¹ÙˆÙ‰ Ø§Ù„Ø¢Ù†';
                } else if (daysSinceGrievance >= 60) {
                    // No response after 60 days - can file
                    deadlineDate = new Date(grievance);
                    deadlineDate.setDate(deadlineDate.getDate() + 120);
                    daysRemaining = Math.floor((deadlineDate - today) / (1000 * 60 * 60 * 24));
                    canFile = true;
                    message = 'Ù…Ø¶Ù‰ 60 ÙŠÙˆÙ…Ø§Ù‹ Ø¨Ø¯ÙˆÙ† Ø±Ø¯ - ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø§Ù„Ø¯Ø¹ÙˆÙ‰';
                } else {
                    // Still waiting for response
                    daysRemaining = 60 - daysSinceGrievance;
                    canFile = false;
                    message = `Ø§Ù†ØªØ¸Ø± ${daysRemaining} ÙŠÙˆÙ…Ø§Ù‹ Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ù…Ø¯Ø© Ø§Ù„Ø±Ø¯`;
                }
                
                return { daysRemaining, canFile, message, deadlineDate, daysSinceGrievance };
            };
            
            const result = calculateDeadline();
            
            return (
                <div className="card p-4 sm:p-6 border-2 border-bog-green/30 bg-bog-green/5">
                    <div className="flex items-center gap-2 mb-4">
                        <Icons.Clock />
                        <h3 className="font-bold text-gray-800">Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©</h3>
                    </div>
                    
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¸Ù„Ù…</label>
                            <input 
                                type="date" 
                                value={dates.grievanceDate} 
                                onChange={(e) => setDates({...dates, grievanceDate: e.target.value})}
                                className="w-full p-2 border rounded-lg text-sm"
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">ØªØ§Ø±ÙŠØ® Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© (Ø¥Ù† ÙˆØ¬Ø¯)</label>
                            <input 
                                type="date" 
                                value={dates.responseDate} 
                                onChange={(e) => setDates({...dates, responseDate: e.target.value})}
                                className="w-full p-2 border rounded-lg text-sm"
                            />
                        </div>
                    </div>
                    
                    {result && (
                        <div className={`p-4 rounded-lg ${result.canFile ? 'bg-green-100 border border-green-300' : 'bg-yellow-100 border border-yellow-300'}`}>
                            <div className="flex items-center justify-between mb-2">
                                <span className={`font-bold ${result.canFile ? 'text-green-800' : 'text-yellow-800'}`}>
                                    {result.canFile ? 'âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…' : 'â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¯Ø©'}
                                </span>
                                <span className={`text-2xl font-bold ${result.canFile ? 'text-green-600' : 'text-yellow-600'}`}>
                                    {Math.abs(result.daysRemaining)} ÙŠÙˆÙ…
                                </span>
                            </div>
                            <p className={`text-sm ${result.canFile ? 'text-green-700' : 'text-yellow-700'}`}>{result.message}</p>
                            {result.deadlineDate && result.canFile && (
                                <p className="text-xs mt-2 text-gray-600">
                                    Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…: {result.deadlineDate.toLocaleDateString('ar-SA')}
                                </p>
                            )}
                        </div>
                    )}
                    
                    <div className="mt-4 p-3 bg-gray-50 rounded-lg">
                        <p className="text-xs text-gray-600 font-medium mb-2">ğŸ“š Ø§Ù„Ù…Ø¯Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©:</p>
                        <ul className="text-xs text-gray-500 space-y-1">
                            <li>â€¢ 60 ÙŠÙˆÙ…Ø§Ù‹: Ù…Ø¯Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¸Ù„Ù…</li>
                            <li>â€¢ 60 ÙŠÙˆÙ…Ø§Ù‹: Ù…Ø¯Ø© Ø±ÙØ¹ Ø§Ù„Ø¯Ø¹ÙˆÙ‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø±Ø¯ Ø£Ùˆ ÙÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø©</li>
                        </ul>
                    </div>
                </div>
            );
        };

        // ===== WAKALA VERIFICATION =====
        const WakalaVerification = ({ onVerified }) => {
            const [wakalaNumber, setWakalaNumber] = useState('');
            const [verifying, setVerifying] = useState(false);
            const [result, setResult] = useState(null);
            
            const handleVerify = () => {
                setVerifying(true);
                setTimeout(() => {
                    setResult({
                        valid: true,
                        number: wakalaNumber || '123456789',
                        issueDate: '1446/01/15',
                        expiryDate: '1447/01/15',
                        principal: 'Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø§Ù„Ø³Ø¹ÙŠØ¯',
                        agent: 'Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯',
                        permissions: ['Ø§Ù„ØªÙ‚Ø§Ø¶ÙŠ Ø£Ù…Ø§Ù… Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ø§Ù„Ù…', 'ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯Ø¹Ø§ÙˆÙ‰ ÙˆØ§Ù„Ø·Ø¹ÙˆÙ†', 'Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£Ø­ÙƒØ§Ù…']
                    });
                    setVerifying(false);
                    onVerified && onVerified(true);
                }, 2000);
            };
            
            return (
                <div className="card p-4 sm:p-6 border-2 border-blue-200 bg-blue-50">
                    <div className="flex items-center gap-2 mb-4">
                        <Icons.Link />
                        <h3 className="font-bold text-gray-800">Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø¹Ø¨Ø± Ù†Ø§Ø¬Ø²</h3>
                    </div>
                    
                    {!result ? (
                        <>
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-1">Ø±Ù‚Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø©</label>
                                <input 
                                    type="text" 
                                    value={wakalaNumber}
                                    onChange={(e) => setWakalaNumber(e.target.value)}
                                    placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø©"
                                    className="w-full p-3 border rounded-lg"
                                />
                            </div>
                            <button 
                                onClick={handleVerify}
                                disabled={verifying}
                                className="w-full p-3 bg-blue-600 text-white rounded-lg font-bold flex items-center justify-center gap-2"
                            >
                                {verifying ? (
                                    <>
                                        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...
                                    </>
                                ) : (
                                    <>
                                        <Icons.ExternalLink />
                                        ØªØ­Ù‚Ù‚ Ø¹Ø¨Ø± Ù†Ø§Ø¬Ø²
                                    </>
                                )}
                            </button>
                            <p className="text-xs text-gray-500 text-center mt-2">* Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„ØªØ­Ù‚Ù‚ - Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠ</p>
                        </>
                    ) : (
                        <div className="space-y-3 fade-in">
                            <div className="flex items-center gap-2 p-3 bg-green-100 rounded-lg border border-green-300">
                                <Icons.Check />
                                <span className="font-bold text-green-800">Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø³Ø§Ø±ÙŠØ© ÙˆØµØ­ÙŠØ­Ø©</span>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-3 text-sm">
                                <div className="p-2 bg-white rounded border">
                                    <span className="text-gray-500 text-xs">Ø±Ù‚Ù… Ø§Ù„ÙˆÙƒØ§Ù„Ø©</span>
                                    <p className="font-medium">{result.number}</p>
                                </div>
                                <div className="p-2 bg-white rounded border">
                                    <span className="text-gray-500 text-xs">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</span>
                                    <p className="font-medium text-green-600">{result.expiryDate}</p>
                                </div>
                                <div className="p-2 bg-white rounded border">
                                    <span className="text-gray-500 text-xs">Ø§Ù„Ù…ÙˆÙƒÙÙ‘Ù„</span>
                                    <p className="font-medium">{result.principal}</p>
                                </div>
                                <div className="p-2 bg-white rounded border">
                                    <span className="text-gray-500 text-xs">Ø§Ù„ÙˆÙƒÙŠÙ„</span>
                                    <p className="font-medium">{result.agent}</p>
                                </div>
                            </div>
                            
                            <div className="p-3 bg-white rounded border">
                                <span className="text-gray-500 text-xs">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</span>
                                <div className="flex flex-wrap gap-1 mt-1">
                                    {result.permissions.map((p, i) => (
                                        <span key={i} className="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">âœ“ {p}</span>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ===== DOCUMENT SCANNER =====
        const DocumentScanner = ({ document, onComplete }) => {
            const [stage, setStage] = useState('uploading');
            const [progress, setProgress] = useState(0);
            const [result, setResult] = useState(null);

            useEffect(() => {
                const stages = [{ name: 'uploading', duration: 800, progress: 25 }, { name: 'scanning', duration: 1200, progress: 50 }, { name: 'analyzing', duration: 1500, progress: 75 }, { name: 'complete', duration: 500, progress: 100 }];
                let currentStage = 0;
                const runStage = () => {
                    if (currentStage < stages.length) {
                        setStage(stages[currentStage].name);
                        setProgress(stages[currentStage].progress);
                        setTimeout(() => { currentStage++; runStage(); }, stages[currentStage].duration);
                    } else {
                        const docKey = Object.keys(aiAnalysisResults).find(k => document.name.includes(k)) || 'Ù‡ÙˆÙŠØ©';
                        const aiResult = aiAnalysisResults[docKey];
                        setResult(aiResult);
                        setTimeout(() => onComplete(aiResult), 500);
                    }
                };
                runStage();
            }, []);

            return (
                <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <div className="flex items-center gap-3 mb-3">
                        <div className={`p-2 rounded-full ${stage === 'complete' ? 'bg-green-500' : 'bg-blue-500'} text-white`}>{stage === 'complete' ? <Icons.Check /> : <Icons.Scan />}</div>
                        <div className="flex-1">
                            <div className="font-medium text-gray-800 text-sm">{stage === 'complete' ? 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ÙØ­Øµ' : 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...'}</div>
                            <div className="text-xs text-gray-500 truncate">{document.name}</div>
                        </div>
                        <div className="text-sm font-bold text-blue-600">{progress}%</div>
                    </div>
                    <div className="h-2 bg-gray-200 rounded-full overflow-hidden"><div className="h-full bg-blue-500 progress-bar" style={{ width: `${progress}%` }} /></div>
                </div>
            );
        };

        // ===== AI CHAT =====
        const AIChat = ({ isOpen, onClose }) => {
            const [messages, setMessages] = useState([{ role: 'ai', text: 'Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¤Ø´Ø±. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ' }]);
            const [input, setInput] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            
            const handleSend = () => {
                if (!input.trim()) return;
                setMessages(prev => [...prev, { role: 'user', text: input }]);
                setInput('');
                setIsTyping(true);
                setTimeout(() => {
                    const responses = {
                        'Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª': 'ØªØ­ØªØ§Ø¬: ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ©ØŒ ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø±Ø§Ø±ØŒ Ø§Ù„ØªØ¸Ù„Ù… Ø§Ù„Ù…Ù‚Ø¯Ù…ØŒ ÙˆØ±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø¥Ù† ÙˆØ¬Ø¯.',
                        'Ø§Ù„ØªØ¸Ù„Ù…': 'ÙŠØ¬Ø¨ ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„ØªØ¸Ù„Ù… Ø®Ù„Ø§Ù„ 60 ÙŠÙˆÙ…Ø§Ù‹ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù„Ù… Ø¨Ø§Ù„Ù‚Ø±Ø§Ø±.',
                        'Ø§Ù„Ù…Ø¯Ø©': 'Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ© Ù„Ø±ÙØ¹ Ø§Ù„Ø¯Ø¹ÙˆÙ‰ 60 ÙŠÙˆÙ…Ø§Ù‹ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø£Ùˆ Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø¯Ø© Ø§Ù„Ù€ 60 ÙŠÙˆÙ…Ø§Ù‹.',
                        'Ø§Ù„ÙˆÙƒØ§Ù„Ø©': 'ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø³Ø§Ø±ÙŠØ© ÙˆØªØªØ¶Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªÙ‚Ø§Ø¶ÙŠ Ø£Ù…Ø§Ù… Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ø§Ù„Ù….',
                    };
                    const key = Object.keys(responses).find(k => input.includes(k));
                    setMessages(prev => [...prev, { role: 'ai', text: responses[key] || 'ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©.' }]);
                    setIsTyping(false);
                }, 1500);
            };

            if (!isOpen) return null;

            return (
                <>
                    <div className="fixed inset-0 bg-black/50 z-40 sm:hidden" onClick={onClose}></div>
                    <div className="chat-container fixed bottom-0 left-0 right-0 sm:bottom-20 sm:left-4 sm:right-auto w-full sm:w-96 bg-white rounded-t-2xl sm:rounded-xl overflow-hidden z-50 fade-in shadow-2xl border max-h-[80vh]">
                        <div className="bg-bog-green text-white p-3 flex items-center justify-between">
                            <div className="flex items-center gap-2"><Icons.AI /><span className="font-bold text-sm">Ù…Ø³Ø§Ø¹Ø¯ Ù…Ø¤Ø´Ø±</span></div>
                            <button onClick={onClose} className="p-2 hover:bg-white/20 rounded-lg"><Icons.Close /></button>
                        </div>
                        <div className="h-60 overflow-y-auto p-3 bg-gray-50">
                            {messages.map((msg, i) => (
                                <div key={i} className={`mb-3 ${msg.role === 'user' ? 'text-left' : 'text-right'}`}>
                                    <div className={`inline-block p-2 rounded-xl max-w-[85%] text-sm ${msg.role === 'user' ? 'bg-bog-green text-white rounded-bl-none' : 'bg-white border rounded-br-none'}`}>{msg.text}</div>
                                </div>
                            ))}
                            {isTyping && <div className="text-right"><div className="inline-block p-3 bg-white border rounded-xl"><span className="typing"><span>â—</span><span>â—</span><span>â—</span></span></div></div>}
                        </div>
                        <div className="p-3 border-t flex gap-2 safe-area-bottom">
                            <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSend()} placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." className="flex-1 border rounded-lg px-3 py-2 text-sm" />
                            <button onClick={handleSend} className="btn-primary text-white px-4 py-2 rounded-lg text-sm">Ø¥Ø±Ø³Ø§Ù„</button>
                        </div>
                    </div>
                </>
            );
        };

        // ===== PROTOTYPE TAB =====
        const PrototypeTab = ({ user }) => {
            const [step, setStep] = useState(1);
            const [answers, setAnswers] = useState({});
            const [dates, setDates] = useState({ grievanceDate: '', responseDate: '' });
            const [scanningDoc, setScanningDoc] = useState(null);
            const [showChat, setShowChat] = useState(false);
            const [wakalaVerified, setWakalaVerified] = useState(false);
            const [documents, setDocuments] = useState([
                { id: 1, name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©', status: null, required: true, aiResult: null },
                { id: 2, name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ', status: null, required: true, aiResult: null },
                { id: 3, name: 'Ø§Ù„ØªØ¸Ù„Ù… Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ù„Ø¬Ù‡Ø©', status: null, required: true, aiResult: null },
                { id: 4, name: 'Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¸Ù„Ù…', status: null, required: false, aiResult: null },
            ]);

            useEffect(() => {
                if (step === 2) {
                    const baseDocs = [
                        { id: 1, name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©', status: null, required: true, aiResult: null },
                        { id: 2, name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ', status: null, required: true, aiResult: null },
                        { id: 3, name: 'Ø§Ù„ØªØ¸Ù„Ù… Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ù„Ø¬Ù‡Ø©', status: null, required: true, aiResult: null },
                        { id: 4, name: 'Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¸Ù„Ù…', status: null, required: false, aiResult: null },
                    ];
                    if (answers.q3 === 'agent' || answers.q3 === 'lawyer') {
                        baseDocs.push({ id: 5, name: 'Ø§Ù„ÙˆÙƒØ§Ù„Ø© Ø§Ù„Ø´Ø±Ø¹ÙŠØ©', status: null, required: true, aiResult: null });
                    }
                    if (answers.q3 === 'lawyer') {
                        baseDocs.push({ id: 6, name: 'Ø±Ø®ØµØ© Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø© Ø³Ø§Ø±ÙŠØ©', status: null, required: true, aiResult: null });
                    }
                    setDocuments(baseDocs);
                }
            }, [step, answers.q3]);

            const questions = [
                { id: 'q1', q: 'Ù…Ø§ Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ', options: [{ value: 'decision', label: 'Ù‚Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±ÙŠ' }, { value: 'contract', label: 'Ù†Ø²Ø§Ø¹ Ø¹Ù‚Ø¯' }, { value: 'compensation', label: 'ØªØ¹ÙˆÙŠØ¶' }, { value: 'other', label: 'Ø£Ø®Ø±Ù‰' }] },
                { id: 'q2', q: 'Ù‡Ù„ ØªØ¸Ù„Ù…Øª Ù„Ù„Ø¬Ù‡Ø©ØŸ', options: [{ value: 'yes_replied', label: 'Ù†Ø¹Ù…ØŒ ÙˆØ¬Ø§Ø¡ Ø§Ù„Ø±Ø¯ ÙˆÙ„Ù… ØªÙ…Ø¶ÙŠ Ø¹Ù„ÙŠÙ‡ Ù¦Ù  ÙŠÙˆÙ…' }, { value: 'yes_no_reply', label: 'Ù†Ø¹Ù…ØŒ ÙˆÙ„Ù… ÙŠØ£Øª Ø±Ø¯ Ø¨Ø¹Ø¯ Ù¦Ù  ÙŠÙˆÙ…' }, { value: 'no', label: 'Ù„Ø§ØŒ Ù„Ù… Ø£ØªØ¸Ù„Ù… Ø¨Ø¹Ø¯' }] },
                { id: 'q3', q: 'Ù‡Ù„ Ø£Ù†Øª:', options: [{ value: 'applicant', label: 'ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø£Ù†' }, { value: 'agent', label: 'ÙˆÙƒÙŠÙ„' }, { value: 'lawyer', label: 'Ù…Ø­Ø§Ù…Ù' }] },
                { id: 'q4', q: 'Ù‡Ù„ Ø£Ù†Øª Ø£ÙŠØ¶Ø§Ù‹ Ø£Ø­Ø¯ Ø§Ù„Ù…Ø¯Ø¹ÙŠÙ†ØŸ', options: [{ value: 'yes', label: 'Ù†Ø¹Ù…' }, { value: 'no', label: 'Ù„Ø§ØŒ ÙˆÙƒÙŠÙ„ ÙÙ‚Ø·' }], showIf: 'agent' },
            ];

            const handleUpload = (docId) => setScanningDoc(documents.find(d => d.id === docId));
            const handleScanComplete = (docId, result) => { setDocuments(docs => docs.map(d => d.id === docId ? { ...d, status: result.status, aiResult: result } : d)); setScanningDoc(null); };
            const completionRate = () => { const required = documents.filter(d => d.required); return Math.round((required.filter(d => d.status === 'success' || d.status === 'warning').length / required.length) * 100); };
            const resetPrototype = () => { setStep(1); setAnswers({}); setDates({ grievanceDate: '', responseDate: '' }); setWakalaVerified(false); setDocuments([{ id: 1, name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©', status: null, required: true, aiResult: null }, { id: 2, name: 'ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠ', status: null, required: true, aiResult: null }, { id: 3, name: 'Ø§Ù„ØªØ¸Ù„Ù… Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ù„Ø¬Ù‡Ø©', status: null, required: true, aiResult: null }, { id: 4, name: 'Ø±Ø¯ Ø§Ù„Ø¬Ù‡Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ¸Ù„Ù…', status: null, required: false, aiResult: null }]); };
            
            const canProceed = () => {
                if (answers.q2 === 'no') return false;
                if (!answers.q1 || !answers.q2 || !answers.q3) return false;
                if (answers.q3 === 'agent' && !answers.q4) return false;
                return true;
            };

            const getRoleLabel = () => {
                if (answers.q3 === 'applicant') return 'ØµØ§Ø­Ø¨ Ø§Ù„Ø´Ø£Ù†';
                if (answers.q3 === 'lawyer') return 'Ù…Ø­Ø§Ù…Ù';
                if (answers.q3 === 'agent') return answers.q4 === 'yes' ? 'ÙˆÙƒÙŠÙ„ ÙˆÙ…ÙØ¯ÙÙ‘Ø¹Ù' : 'ÙˆÙƒÙŠÙ„';
                return '';
            };

            const renderStep1 = () => (
                <div className="space-y-4">
                    {user && (
                        <div className="card p-3 bg-green-50 border-green-200 flex items-center gap-3">
                            <div className="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white"><Icons.Shield /></div>
                            <div><div className="font-bold text-green-800 text-sm">{user.name}</div><div className="text-xs text-green-600">âœ“ Ù…ÙˆØ«Ù‚ Ø¹Ø¨Ø± Ù†ÙØ§Ø°</div></div>
                        </div>
                    )}
                    
                    <div className="text-center mb-4">
                        <div className="inline-flex items-center gap-2 bg-bog-green/10 text-bog-green px-3 py-2 rounded-full text-xs font-medium mb-2"><Icons.AI /><span>Ø®Ø¯Ù…Ø© Ù…Ø¤Ø´Ø±</span></div>
                        <h2 className="text-xl font-bold text-gray-800">Ø­Ø¯Ø¯ Ù†ÙˆØ¹ Ø¯Ø¹ÙˆØ§Ùƒ</h2>
                    </div>
                    
                    {questions.map((item, idx) => {
                        if (item.showIf && answers.q3 !== item.showIf) return null;
                        return (
                            <div key={idx} className="card p-4 fade-in">
                                <div className="flex items-center gap-2 mb-3">
                                    <div className="w-7 h-7 bg-bog-green text-white rounded-full flex items-center justify-center font-bold text-sm">{item.showIf ? 'Ù¤' : idx + 1}</div>
                                    <h3 className="font-bold text-gray-800 text-sm">{item.q}</h3>
                                </div>
                                <div className={`grid gap-2 ${item.options.length === 2 ? 'grid-cols-2' : item.options.length === 3 ? 'grid-cols-3' : 'grid-cols-2'}`}>
                                    {item.options.map((opt, i) => (
                                        <button key={i} onClick={() => {
                                            const newAnswers = {...answers, [item.id]: opt.value};
                                            if (item.id === 'q3' && opt.value !== 'agent') delete newAnswers.q4;
                                            setAnswers(newAnswers);
                                        }} className={`p-3 rounded-xl border-2 text-center transition-all text-sm ${answers[item.id] === opt.value ? 'border-bog-green bg-bog-green/5' : 'border-gray-200'}`}>
                                            {opt.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        );
                    })}
                    
                    {answers.q2 === 'no' && (
                        <div className="card p-4 bg-yellow-50 border-yellow-300">
                            <div className="flex items-start gap-2">
                                <Icons.Warning />
                                <div>
                                    <h4 className="font-bold text-yellow-800 text-sm">ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù‡Ù…</h4>
                                    <p className="text-xs text-yellow-700">ÙŠØ¬Ø¨ Ø§Ù„ØªØ¸Ù„Ù… Ù„Ù„Ø¬Ù‡Ø© Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù‚Ø¨Ù„ Ø±ÙØ¹ Ø§Ù„Ø¯Ø¹ÙˆÙ‰.</p>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Deadline Calculator */}
                    {answers.q2 && answers.q2 !== 'no' && (
                        <DeadlineCalculator dates={dates} setDates={setDates} />
                    )}
                    
                    <button onClick={() => setStep(2)} disabled={!canProceed()} className={`w-full p-3 rounded-xl font-bold flex items-center justify-center gap-2 text-sm ${canProceed() ? 'btn-primary text-white' : 'bg-gray-200 text-gray-400'}`}>
                        Ø§Ù„ØªØ§Ù„ÙŠ <Icons.ArrowLeft />
                    </button>
                </div>
            );

            const renderStep2 = () => (
                <div className="space-y-4">
                    <div className="card p-4 bg-bog-green/5 border-bog-green">
                        <div className="flex items-center gap-3">
                            <div className="w-12 h-12 bg-bog-green rounded-xl flex items-center justify-center text-white"><Icons.Document /></div>
                            <div>
                                <h3 className="font-bold text-gray-800">ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h3>
                                <p className="text-gray-500 text-xs">Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù„Ù„ØªØ­Ù‚Ù‚</p>
                                <div className="mt-1 inline-block bg-bog-gold/20 text-bog-gold px-2 py-0.5 rounded text-xs font-medium">{getRoleLabel()}</div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Wakala Verification for agents/lawyers */}
                    {(answers.q3 === 'agent' || answers.q3 === 'lawyer') && (
                        <WakalaVerification onVerified={setWakalaVerified} />
                    )}
                    
                    <div className="space-y-2">
                        {documents.map(doc => (
                            <div key={doc.id}>
                                {scanningDoc?.id === doc.id ? (
                                    <DocumentScanner document={doc} onComplete={(result) => handleScanComplete(doc.id, result)} />
                                ) : (
                                    <div className={`card p-3 ${doc.status === 'success' ? 'status-success' : doc.status === 'warning' ? 'status-warning' : doc.status === 'error' ? 'status-error' : ''}`}>
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-2 min-w-0">
                                                <div className={`w-8 h-8 rounded-lg flex items-center justify-center ${doc.status === 'success' ? 'bg-green-500 text-white' : doc.status === 'warning' ? 'bg-yellow-500 text-white' : 'bg-gray-100 text-gray-500'}`}><Icons.Document /></div>
                                                <div className="min-w-0">
                                                    <div className="font-medium text-gray-800 text-xs truncate">{doc.name}{doc.required && <span className="text-red-500 mr-1">*</span>}</div>
                                                    {doc.aiResult && <div className={`text-xs ${doc.status === 'success' ? 'text-green-600' : 'text-yellow-600'}`}>{doc.aiResult.message}</div>}
                                                </div>
                                            </div>
                                            {doc.status ? (
                                                <div className={`w-7 h-7 rounded-full flex items-center justify-center text-white ${doc.status === 'success' ? 'bg-green-500' : 'bg-yellow-500'}`}><Icons.Check /></div>
                                            ) : (
                                                <button onClick={() => handleUpload(doc.id)} className="px-3 py-2 bg-bog-green/10 text-bog-green rounded-lg text-xs">Ø±ÙØ¹</button>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        ))}
                    </div>
                    
                    <div className="flex gap-2">
                        <button onClick={() => setStep(1)} className="flex-1 p-3 border-2 border-gray-200 text-gray-700 rounded-xl font-bold text-sm"><Icons.ArrowRight /> Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
                        <button onClick={() => setStep(3)} className="flex-1 p-3 btn-primary text-white rounded-xl font-bold text-sm">Ø§Ù„Ù…Ø¤Ø´Ø± <Icons.ArrowLeft /></button>
                    </div>
                </div>
            );

            const renderStep3 = () => {
                const rate = completionRate();
                const hasErrors = documents.some(d => d.status === 'error' && d.required);
                const getStatusColor = () => rate === 100 && !hasErrors ? 'text-green-500' : rate >= 70 ? 'text-yellow-500' : rate >= 40 ? 'text-orange-500' : 'text-red-500';
                const getStatusBg = () => rate === 100 && !hasErrors ? 'bg-green-500' : rate >= 70 ? 'bg-yellow-500' : rate >= 40 ? 'bg-orange-500' : 'bg-red-500';
                const getStatusText = () => rate === 100 && !hasErrors ? 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…' : rate >= 70 ? 'Ø´Ø¨Ù‡ Ø¬Ø§Ù‡Ø²' : rate >= 40 ? 'ÙŠØ­ØªØ§Ø¬ Ø§Ø³ØªÙƒÙ…Ø§Ù„' : 'ØºÙŠØ± Ø¬Ø§Ù‡Ø²';
                
                return (
                    <div className="space-y-4">
                        {/* Gauge */}
                        <div className={`card p-6 text-center ${rate === 100 && !hasErrors ? 'ai-glow' : ''}`}>
                            <h2 className="text-lg font-bold text-gray-800 mb-4">ğŸ“Š Ù…Ø¤Ø´Ø± Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</h2>
                            <div className="relative w-36 h-36 mx-auto mb-4">
                                <svg className="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                    <circle cx="50" cy="50" r="42" fill="none" stroke="#e5e7eb" strokeWidth="12" />
                                    <circle cx="50" cy="50" r="42" fill="none" className={getStatusBg().replace('bg-', 'stroke-')} strokeWidth="12" strokeLinecap="round" strokeDasharray={`${rate * 2.64} 264`} style={{ transition: 'stroke-dasharray 1s ease' }} />
                                </svg>
                                <div className="absolute inset-0 flex flex-col items-center justify-center">
                                    <span className={`text-3xl font-bold ${getStatusColor()}`}>{rate}%</span>
                                    <span className="text-xs text-gray-500">{getStatusText()}</span>
                                </div>
                            </div>
                            <div className="flex justify-center gap-2 text-xs">
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-red-500"></span>0-40</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-orange-500"></span>40-70</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-yellow-500"></span>70-99</span>
                                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-green-500"></span>100</span>
                            </div>
                        </div>
                        
                        {/* Summary */}
                        <div className="card p-4">
                            <h3 className="font-bold text-gray-800 mb-3 text-sm">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨</h3>
                            <div className="space-y-2 text-sm">
                                <div className="flex justify-between p-2 bg-gray-50 rounded">
                                    <span className="text-gray-600">Ù†ÙˆØ¹ Ø§Ù„Ø¯Ø¹ÙˆÙ‰</span>
                                    <span className="font-medium">{answers.q1 === 'decision' ? 'Ø¥Ù„ØºØ§Ø¡ Ù‚Ø±Ø§Ø± Ø¥Ø¯Ø§Ø±ÙŠ' : answers.q1 === 'contract' ? 'Ù†Ø²Ø§Ø¹ Ø¹Ù‚Ø¯' : answers.q1 === 'compensation' ? 'ØªØ¹ÙˆÙŠØ¶' : 'Ø£Ø®Ø±Ù‰'}</span>
                                </div>
                                <div className="flex justify-between p-2 bg-gray-50 rounded">
                                    <span className="text-gray-600">ØµÙØ© Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</span>
                                    <span className="font-medium">{getRoleLabel()}</span>
                                </div>
                                <div className="flex justify-between p-2 bg-gray-50 rounded">
                                    <span className="text-gray-600">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„Ù…</span>
                                    <span className="font-medium text-green-600">{answers.q2 === 'yes_replied' ? 'ØªÙ… ÙˆØ¬Ø§Ø¡ Ø§Ù„Ø±Ø¯' : 'ØªÙ… ÙˆÙ„Ù… ÙŠØ±Ø¯'}</span>
                                </div>
                                {dates.grievanceDate && (
                                    <div className="flex justify-between p-2 bg-gray-50 rounded">
                                        <span className="text-gray-600">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¸Ù„Ù…</span>
                                        <span className="font-medium">{dates.grievanceDate}</span>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        {/* Documents Status */}
                        <div className="card p-4">
                            <h3 className="font-bold text-gray-800 mb-3 text-sm">ğŸ“ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h3>
                            <div className="space-y-2">
                                {documents.map(doc => (
                                    <div key={doc.id} className={`p-2 rounded-lg flex items-center justify-between ${doc.status === 'success' ? 'bg-green-50' : doc.status === 'warning' ? 'bg-yellow-50' : 'bg-gray-50'}`}>
                                        <span className="text-xs">{doc.name}</span>
                                        {doc.status ? (
                                            <span className={`text-xs font-medium ${doc.status === 'success' ? 'text-green-600' : 'text-yellow-600'}`}>{doc.aiResult?.message}</span>
                                        ) : (
                                            <span className="text-xs text-gray-400">Ù„Ù… ÙŠÙØ±ÙØ¹</span>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        {rate === 100 && !hasErrors ? (
                            <button className="w-full p-4 btn-primary text-white rounded-xl font-bold flex items-center justify-center gap-2">
                                <Icons.Link /> Ø§Ù†ØªÙ‚Ù„ Ù„Ù…Ù†ØµØ© Ù…Ø¹ÙŠÙ† Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯Ø¹ÙˆÙ‰
                            </button>
                        ) : (
                            <div className="card p-4 bg-yellow-50 border-yellow-300">
                                <div className="flex items-start gap-2">
                                    <Icons.Warning />
                                    <div>
                                        <h4 className="font-bold text-yellow-800 text-sm">Ø£ÙƒÙ…Ù„ Ø§Ù„Ù†ÙˆØ§Ù‚Øµ</h4>
                                        <p className="text-xs text-yellow-700 mb-2">Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ©</p>
                                        <button onClick={() => setStep(2)} className="px-3 py-2 bg-yellow-600 text-white rounded-lg text-xs font-medium">Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</button>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <button onClick={resetPrototype} className="w-full p-3 text-gray-500 text-xs">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙØ­Øµ</button>
                    </div>
                );
            };

            return (
                <div className="max-w-2xl mx-auto px-3">
                    {/* Steps */}
                    <div className="flex items-center justify-center gap-2 mb-6">
                        {[{ num: 1, label: 'ØªØ­Ø¯ÙŠØ¯' }, { num: 2, label: 'ÙØ­Øµ' }, { num: 3, label: 'Ø§Ù„Ù…Ø¤Ø´Ø±' }].map((s, i) => (
                            <div key={s.num} className="flex items-center">
                                <div className="flex flex-col items-center">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center font-bold ${step >= s.num ? 'bg-bog-green text-white' : 'bg-gray-200 text-gray-500'}`}>{step > s.num ? <Icons.Check /> : s.num}</div>
                                    <span className={`text-xs mt-1 ${step >= s.num ? 'text-bog-green font-medium' : 'text-gray-400'}`}>{s.label}</span>
                                </div>
                                {i < 2 && <div className={`w-8 h-1 mx-1 rounded ${step > s.num ? 'bg-bog-green' : 'bg-gray-200'}`}/>}
                            </div>
                        ))}
                    </div>
                    
                    {step === 1 && renderStep1()}
                    {step === 2 && renderStep2()}
                    {step === 3 && renderStep3()}
                    
                    {/* Chat Button */}
                    <button onClick={() => setShowChat(!showChat)} className="fixed bottom-4 left-4 w-12 h-12 btn-primary text-white rounded-full flex items-center justify-center shadow-lg z-30"><Icons.Chat /></button>
                    <AIChat isOpen={showChat} onClose={() => setShowChat(false)} />
                </div>
            );
        };

        // ===== FEATURES TAB =====
        const FeaturesTab = () => {
            const features = [
                { icon: <Icons.Clock />, title: 'Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯', desc: 'Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©', tech: 'Auto' },
                { icon: <Icons.Link />, title: 'ØªØ­Ù‚Ù‚ Ø§Ù„ÙˆÙƒØ§Ù„Ø©', desc: 'Ø±Ø¨Ø· Ù…Ø¹ Ù†Ø§Ø¬Ø²', tech: 'API' },
                { icon: <Icons.Scan />, title: 'ÙØ­Øµ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª', desc: 'ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ', tech: 'AI' },
                { icon: <Icons.Fingerprint />, title: 'Ù†ÙØ§Ø°', desc: 'ØªØ³Ø¬ÙŠÙ„ Ø¢Ù…Ù†', tech: 'SSO' },
                { icon: <Icons.Chat />, title: 'Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ', desc: 'Ø¥Ø±Ø´Ø§Ø¯ ÙÙˆØ±ÙŠ', tech: 'Chat' },
                { icon: <Icons.BarChart />, title: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±ÙØ¶', desc: 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', tech: 'Analytics' },
            ];
            return (
                <div className="max-w-4xl mx-auto space-y-4 px-3">
                    <div className="card p-6 text-center">
                        <h2 className="text-2xl font-bold text-gray-800 mb-2">ğŸ“Š Ù…Ø¤Ø´Ø±</h2>
                        <p className="text-gray-600">ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø¯Ø¹ÙˆØ§Ùƒ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</p>
                    </div>
                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                        {features.map((f, i) => (
                            <div key={i} className="card p-4">
                                <div className="w-10 h-10 bg-bog-green/10 text-bog-green rounded-xl flex items-center justify-center mb-3">{f.icon}</div>
                                <h3 className="font-bold text-gray-800 mb-1 text-sm">{f.title}</h3>
                                <p className="text-xs text-gray-600 mb-2">{f.desc}</p>
                                <span className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">{f.tech}</span>
                            </div>
                        ))}
                    </div>
                    <div className="card p-4 bg-bog-green/5 border-bog-green">
                        <h3 className="font-bold text-gray-800 mb-3 text-center">ğŸ“ˆ Ø§Ù„Ø£Ø«Ø± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</h3>
                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-3 text-center">
                            <div className="p-3 bg-white rounded-lg"><div className="text-2xl font-bold text-bog-green">70%</div><div className="text-xs text-gray-500">ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div>
                            <div className="p-3 bg-white rounded-lg"><div className="text-2xl font-bold text-bog-green">85%</div><div className="text-xs text-gray-500">ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø±ÙØ¶ Ø§Ù„Ø´ÙƒÙ„ÙŠ</div></div>
                            <div className="p-3 bg-white rounded-lg"><div className="text-2xl font-bold text-bog-green">+40%</div><div className="text-xs text-gray-500">Ø±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</div></div>
                            <div className="p-3 bg-white rounded-lg"><div className="text-2xl font-bold text-bog-green">ÙÙˆØ±ÙŠ</div><div className="text-xs text-gray-500">Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ­Øµ</div></div>
                        </div>
                        <p className="text-xs text-gray-500 text-center mt-3">* Ø£Ø±Ù‚Ø§Ù… ØªÙ‚Ø¯ÙŠØ±ÙŠØ© Ù„Ù„ØªÙˆØ¶ÙŠØ­</p>
                    </div>
                </div>
            );
        };

        // ===== MAIN APP =====
        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('prototype');

            if (!isLoggedIn) return <NafathLogin onLoginSuccess={(u) => { setUser(u); setIsLoggedIn(true); }} />;

            return (
                <div className="min-h-screen flex flex-col">
                    <Header user={user} onLogout={() => { setUser(null); setIsLoggedIn(false); }} />
                    <RejectionStatsBanner />
                    <StatsSection />
                    <main className="flex-1 max-w-6xl mx-auto w-full pb-20 sm:pb-8">
                        <div className="text-center mb-4 px-3">
                            <h1 className="text-2xl font-bold text-gray-800 mb-1">ğŸ“Š Ù…Ø¤Ø´Ø±</h1>
                            <p className="text-gray-600 text-sm">ØªØ¹Ø±Ù‘Ù Ø¹Ù„Ù‰ Ø¬Ø§Ù‡Ø²ÙŠØ© Ø¯Ø¹ÙˆØ§Ùƒ Ù‚Ø¨Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</p>
                        </div>
                        <div className="flex justify-center gap-2 mb-4 px-3">
                            <button onClick={() => setActiveTab('prototype')} className={`px-4 py-2 rounded-xl font-bold text-sm ${activeTab === 'prototype' ? 'bg-bog-green text-white' : 'bg-white text-gray-700 border'}`}>Ø¬Ø±Ù‘Ø¨ Ù…Ø¤Ø´Ø±</button>
                            <button onClick={() => setActiveTab('features')} className={`px-4 py-2 rounded-xl font-bold text-sm ${activeTab === 'features' ? 'bg-bog-green text-white' : 'bg-white text-gray-700 border'}`}>Ø¹Ù† Ø§Ù„Ø®Ø¯Ù…Ø©</button>
                        </div>
                        {activeTab === 'prototype' ? <PrototypeTab user={user} /> : <FeaturesTab />}
                    </main>
                    <footer className="bg-bog-greenDark text-white py-4 safe-area-bottom">
                        <div className="max-w-6xl mx-auto px-4 text-center">
                            <p className="text-green-200 text-sm">Ù‡Ø§ÙƒØ§Ø«ÙˆÙ† Ø°ÙƒØ§Ø¡ Ø§Ù„Ù‚Ø¶Ø§Ø¡ | Ø¯ÙŠÙˆØ§Ù† Ø§Ù„Ù…Ø¸Ø§Ù„Ù…</p>
                            <p className="text-xs text-green-300 mt-1">4-5 ÙØ¨Ø±Ø§ÙŠØ± 2026</p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
